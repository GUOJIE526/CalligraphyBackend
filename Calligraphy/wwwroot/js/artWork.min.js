import{fetchImage}from"./showImg.js";let table=$("#ArtTable").DataTable({ajax:{url:"/Home/AllArtworkJson",type:"GET",dataSrc:"",datatype:"Json"},pagingType:"full_numbers",fixedHeader:{header:!0},language:{url:"https://cdn.datatables.net/plug-ins/2.1.5/i18n/zh-HANT.json"},columns:[{data:"title"},{data:"views"},{data:"description",render:function(n){return n?n.length>10?n.substring(0,10)+"...":n:""}},{data:"createdYear",render:function(n){if(n)return new Date(n).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})}},{data:"style"},{data:"material"},{data:"size"},{data:"isVisible",render:function(n,t,i){const r=n?"checked":"";return`<label class="switch">
                          <input type="checkbox" class="toggle-visible" data-id="${i.artWorkId}" ${r}>
                          <span class="slider"></span>
                        </label>`}},{data:"artWorkId",render:function(n){return`
                    <div class = "text-nowrap">
                        <a data-id="${n}" class="EditBtn btn btn-info" data-bs-toggle="modal" data-bs-target="#EditModal">
                            <i class="ti ti-edit" style="font-size:18px;"></i>
                        </a>
                        <a data-id="${n}" class="deleteBtn btn btn-danger">
                            <i class="ti ti-trash" style="font-size:18px;"></i>
                        </a>
                    </div>
                `}}]});$(document).on("change",".toggle-visible",async function(){const t=$(this).data("id"),n=$(this).is(":checked");let i=await fetch("/Home/ToggleIsVisible",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()},body:JSON.stringify({ArtWorkId:t,IsVisible:n})});i.ok||(alert("顯示更新失敗"),$(".toggle-visible").prop("checked",!n))});table.on("click","tbody tr",async function(n){if(!($(n.target).closest(".EditBtn").length>0)&&!($(n.target).closest(".switch").length>0)&&!($(n.target).closest(".deleteBtn").length>0)){let t=table.row(this).data(),i=t.artWorkId;await fetchImage(i,t.title)}});$(document).on("click",".EditBtn",async function(){var n=$(this).data("id");let t=await fetch(`/Home/ArtWorkPartial/${n}`),i=await t.text();$(".Edit").html(i);$(document).off("submit","#EditForm").on("submit","#EditForm",async function(n){n.preventDefault();let i=new FormData(this),t=await fetch($(this).attr("action"),{method:"POST",body:i,headers:{"X-Requested-With":"XMLHttpRequest",RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}});if(t.ok){let n=await t.json();n.success?(Swal.fire({icon:"success",title:"作品更新成功!",showConfirmButton:!1,timer:1500}),$("#EditModal").modal("hide"),$("#ArtTable").DataTable().ajax.reload(null,!1)):Swal.fire({icon:"error",title:"Oops...",text:n.errors?n.errors.join(", "):n.message})}else Swal.fire({icon:"error",title:"Oops...",text:"請求發生錯誤，請稍後再試"})});$("#EditModal").modal("show")});$(document).on("click",".deleteBtn",async function(){let n=$(this).data("id");Swal.fire({title:"確定要刪除這個作品嗎?",text:"刪除後將無法恢復!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonColor:"#d33"}).then(async t=>{if(t.isConfirmed){let t=await fetch(`/Home/DeleteArtWork/${n}`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest",RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}});t.ok?(Swal.fire({icon:"success",title:"作品已刪除!",showConfirmButton:!1,timer:1500}),$("#ArtTable").DataTable().ajax.reload(null,!1)):Swal.fire({icon:"error",title:"Oops...",text:"刪除失敗，請稍後再試"})}})});